var zIndex = 2;
var categoryList = ['cats', 'kittens', 'girls', 'sexy girl'];
var localization = {
    'ru': {
        subtitle: 'фотообои для ПК и мобильного',
        description: 'Скачать приложение для автоматической смены обоев',
        copyright: 'Напишите нам'
    }
}

function changeBackground() {
    var e = new XMLHttpRequest;
    e.open("GET", "https://source.unsplash.com/" + screen.width + "x" + screen.height + "?" + categoryList[Math.floor(Math.random() * categoryList.length)]),
    e.responseType = "blob",
    e.send(),
    e.addEventListener("load", function () {
        var n = new FileReader; 
        n.readAsDataURL(e.response), 
        n.addEventListener("loadend", function () {
            $(".backgrounds").append($('<div class="background"></div>').css({
                "background-image": 'url("' + n.result + '"',
                "z-index": zIndex 
            })),
            1 != zIndex ? (setTimeout(function () {
                $(".background:last-child").addClass("is-visible")
            }, 1e3),
            setTimeout(function () {
                $(".background:not(:last-child)").remove()
            }, 2e3)) : (setTimeout(function () {
                $(".background:last-child").addClass("is-visible")
            }, 500), setTimeout(function () {
                $(".intro").remove() }, 2e3)), zIndex++ , setTimeout(changeBackground, 4e3) }) 
    }),
    e.addEventListener("error", function () {
        setTimeout(changeBackground, 500) 
    })
}
function disableScroll() {
    document.ontouchmove = function (e) {
        e.preventDefault()
    }
} 

function showContent() {
    var userLang = navigator.language || navigator.userLanguage; 
    if (userLang === 'ru' || userLang === 'ru-RU') {
        $('.subtitle')[0].innerHTML = '<a href="https://unsplash.com" target="_blank">Unsplash</a> ' + localization['ru'].subtitle;
        $('.description')[0].innerHTML = localization['ru'].description;
        $('.copyright a')[0].innerHTML = localization['ru'].copyright;
    }

    $(".loader").addClass("is-hidden"),
    $(".content").addClass("is-visible")
}

$(function () {
    setTimeout(changeBackground, 4e3),
    disableScroll()
}), $(window).on("load", showContent);